<!-- ðŸ”¹ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

<style>
  body {
    font-family: 'Cairo', sans-serif;
  }

  /* ðŸ”¹ Ø§Ù„Ù‡ÙŠØ¯Ø± */
  .navbar {
    background-color: #2f3233 !important;
    transition: all 0.3s ease;
    height: 80px;
    z-index: 9999;
  }

  /* âœ… Ø§Ù„Ù„ÙˆØ¬Ùˆ */
  .navbar-brand img {
    margin-right: 7.5rem !important;
    transform: scale(1.3);
    transform-origin: right center;
    transition: transform 0.3s ease;
  }

  @media (max-width: 768px) {
    .navbar-brand img {
      margin-right: 1rem !important;
      transform: scale(1);
    }
  }

  /* ðŸ”¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
  .navbar-nav .nav-link {
    color: #ffffff !important;
    font-weight: 600;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: color 0.3s ease, transform 0.2s ease;
  }

  .navbar-nav .nav-link i {
    color: #2ecc71 !important;
  }

  .navbar-nav .nav-link:hover,
  .navbar-nav .nav-link.active {
    color: #2ecc71 !important;
    transform: scale(1.05);
  }

  .navbar.scrolled {
    background-color: #1e1e1e !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }

  .navbar .btn-success {
    font-weight: 600;
    background-color: #2ecc71;
    border: none;
    transition: 0.3s;
  }

  .navbar .btn-success:hover {
    background-color: #27ae60 !important;
  }
</style>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow-sm py-2">
  <div class="container-fluid d-flex align-items-center justify-content-between">

    <a class="navbar-brand d-flex align-items-center" href="#" id="homeLink">
      <img src="#" alt="Hanwsallk" width="150" id="headerLogo">
    </a>

    <div class="collapse navbar-collapse justify-content-center" id="mainNav">
      <ul class="navbar-nav align-items-center gap-lg-3">
        <li class="nav-item"><a class="nav-link" href="#" data-href="about.html"><i class="fa-solid fa-circle-info"></i> <span data-i18n="header.about"></span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-href="help-center.html"><i class="fa-solid fa-circle-question"></i> <span data-i18n="header.help"></span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-href="safety.html"><i class="fa-solid fa-shield-halved"></i> <span data-i18n="header.safety"></span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-href="success-stories.html"><i class="fa-solid fa-star"></i> <span data-i18n="header.successStories"></span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-href="blog.html"><i class="fa-solid fa-book-open"></i> <span data-i18n="header.blog"></span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-href="sender.html"><i class="fa-solid fa-user"></i> <span data-i18n="header.sender"></span></a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-href="drivers.html"><i class="fa-solid fa-truck-fast"></i> <span data-i18n="header.driver"></span></a></li>
      </ul>
    </div>

    <div class="d-flex align-items-center me-lg-4 gap-2">
      <!-- Language Switcher -->
      <div id="languageSwitcher"></div>
      
      <span id="authButtons">
        <a href="#" class="btn btn-outline-light rounded-pill px-3 me-2" id="loginBtn" data-href="login.html" data-i18n="header.login">
          <i class="fa-solid fa-sign-in-alt"></i> <span data-i18n="header.login"></span>
        </a>
      </span>
      <span id="userMenu" class="d-none">
        <div class="dropdown">
          <button class="btn btn-success rounded-pill px-3 dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
            <i class="fa-solid fa-user"></i> <span id="userName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#" data-href="dashboard/Customer-dashboard.html"><i class="fa-solid fa-tachometer-alt"></i> <span data-i18n="header.customerDashboard"></span></a></li>
            <li><a class="dropdown-item" href="#" data-href="dashboard/driver-dashboard.html"><i class="fa-solid fa-truck"></i> <span data-i18n="header.driverDashboard"></span></a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" id="logoutBtn"><i class="fa-solid fa-sign-out-alt"></i> <span data-i18n="common.logout"></span></a></li>
          </ul>
        </div>
      </span>
      <a href="#" class="btn btn-outline-light rounded-pill px-3 d-none d-lg-block" data-i18n="header.downloadApp">
        <i class="fa-solid fa-download"></i> <span data-i18n="header.downloadApp"></span>
      </a>
    </div>

    <button class="navbar-toggler me-2" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Load i18n script (path will be fixed by fixPaths script below) -->
<script src="scripts/i18n.js" id="i18nScript"></script>

<!-- Load language switcher -->
<script>
  (function() {
    function loadLanguageSwitcher() {
      const switcherDiv = document.getElementById('languageSwitcher');
      if (!switcherDiv) {
        setTimeout(loadLanguageSwitcher, 100);
        return;
      }

      // Detect if we're in dashboard or root directory
      const isDashboard = window.location.pathname.includes('/dashboard/');
      const basePath = isDashboard ? '../' : '';
      
      fetch(basePath + 'components/language-switcher.html')
        .then(res => res.text())
        .then(data => {
          switcherDiv.innerHTML = data;
          
          // Re-execute scripts in the loaded content - use eval to ensure global scope
          const scripts = switcherDiv.querySelectorAll('script');
          scripts.forEach(oldScript => {
            try {
              // Execute script in global scope
              const scriptContent = oldScript.textContent;
              if (scriptContent) {
                eval(scriptContent);
              }
            } catch (e) {
              console.error('Error executing language switcher script:', e);
            }
            // Remove the old script
            oldScript.remove();
          });

          // Initialize Bootstrap dropdown after a short delay
          setTimeout(() => {
            if (typeof bootstrap !== 'undefined') {
              const dropdownElement = switcherDiv.querySelector('#languageDropdown');
              if (dropdownElement) {
                try {
                  // Remove existing instance if any
                  const existingInstance = bootstrap.Dropdown.getInstance(dropdownElement);
                  if (existingInstance) {
                    existingInstance.dispose();
                  }
                  new bootstrap.Dropdown(dropdownElement);
                } catch (e) {
                  console.log('Dropdown initialization:', e);
                }
              }
            }
          }, 500);
        })
        .catch(err => console.error('Error loading language switcher:', err));
    }

    // Wait a bit for header to be fully loaded
    setTimeout(() => {
      loadLanguageSwitcher();
    }, 200);
  })();
</script>

<script>
  // ðŸ”¹ ØªÙØ¹ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù‡ÙŠØ¯Ø±
  window.addEventListener("scroll", function () {
    const navbar = document.querySelector(".navbar");
    if (window.scrollY > 50) {
      navbar.classList.add("scrolled");
    } else {
      navbar.classList.remove("scrolled");
    }
  });

  // ðŸ”¹ Check authentication status and update header
  (function() {
    function updateAuthUI() {
      // Try to get token from localStorage directly
      const token = localStorage.getItem('authToken') || localStorage.getItem('jwtToken') || '';
      const authButtons = document.getElementById('authButtons');
      const userMenu = document.getElementById('userMenu');
      const userName = document.getElementById('userName');
      const logoutBtn = document.getElementById('logoutBtn');

      if (token) {
        // User is logged in
        if (authButtons) authButtons.classList.add('d-none');
        if (userMenu) userMenu.classList.remove('d-none');
        
        // Get user info from localStorage
        const userInfo = localStorage.getItem('userInfo');
        if (userInfo) {
          try {
            const user = JSON.parse(userInfo);
            if (userName && user.fullName) {
              userName.textContent = user.fullName;
            } else if (userName && user.email) {
              userName.textContent = user.email;
            }
          } catch (e) {
            console.error('Error parsing user info:', e);
          }
        }

        // Handle logout - remove old listeners first
        if (logoutBtn) {
          // Remove any existing listeners
          const newLogoutBtn = logoutBtn.cloneNode(true);
          logoutBtn.parentNode.replaceChild(newLogoutBtn, logoutBtn);
          
          newLogoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Clear all auth data
            localStorage.removeItem('authToken');
            localStorage.removeItem('jwtToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('userInfo');
            // Redirect to home (fix path based on location)
            const isDashboard = window.location.pathname.includes('/dashboard/');
            const basePath = isDashboard ? '../' : '';
            window.location.href = basePath + 'index.html';
          });
        }
      } else {
        // User is not logged in
        if (authButtons) authButtons.classList.remove('d-none');
        if (userMenu) userMenu.classList.add('d-none');
      }
    }

    // Load API script if not already loaded
    if (typeof getAuthToken === 'undefined') {
      const script = document.createElement('script');
      const isDashboard = window.location.pathname.includes('/dashboard/');
      const basePath = isDashboard ? '../' : '';
      script.src = basePath + 'scripts/api.js';
      script.onload = function() {
        updateAuthUI();
        // Also update when storage changes (for logout from other tabs)
        window.addEventListener('storage', updateAuthUI);
      };
      document.head.appendChild(script);
    } else {
      updateAuthUI();
      window.addEventListener('storage', updateAuthUI);
    }

    // Update on page load
    setTimeout(updateAuthUI, 100);
  })();
  
  // Fix all paths based on current location (for dashboard vs root)
  (function fixPaths() {
    const isDashboard = window.location.pathname.includes('/dashboard/');
    const basePath = isDashboard ? '../' : '';
    
    // Fix logo
    const logo = document.getElementById('headerLogo');
    if (logo) {
      logo.src = basePath + 'images/logo2.png';
    }
    
    // Fix home link
    const homeLink = document.getElementById('homeLink');
    if (homeLink) {
      homeLink.href = basePath + 'index.html';
    }
    
    // Fix all links with data-href
    document.querySelectorAll('[data-href]').forEach(link => {
      const href = link.getAttribute('data-href');
      if (href) {
        link.href = basePath + href;
      }
    });
    
    // Fix script paths (only if they start with scripts/ and don't already have basePath)
    document.querySelectorAll('script[src]').forEach(script => {
      const src = script.getAttribute('src');
      if (src && src.startsWith('scripts/') && !src.startsWith(basePath)) {
        script.src = basePath + src;
      }
    });
    
    // Fix language switcher fetch path (update the function)
    const languageSwitcherScript = document.querySelector('script');
    if (languageSwitcherScript && languageSwitcherScript.textContent.includes("fetch('components/language-switcher.html')")) {
      // This will be handled by the loadLanguageSwitcher function itself
    }
    
    // Retry if logo not found yet
    if (!logo) {
      setTimeout(fixPaths, 100);
    }
  })();
  
  // Also run after DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    const isDashboard = window.location.pathname.includes('/dashboard/');
    const basePath = isDashboard ? '../' : '';
    
    const logo = document.getElementById('headerLogo');
    if (logo) logo.src = basePath + 'images/logo2.png';
    
    const homeLink = document.getElementById('homeLink');
    if (homeLink) homeLink.href = basePath + 'index.html';
    
    document.querySelectorAll('[data-href]').forEach(link => {
      const href = link.getAttribute('data-href');
      if (href) link.href = basePath + href;
    });
  });
</script>
